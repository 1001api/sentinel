(()=>{function x(t){return t?.map(e=>new Date(e.Timestamp).toDateString())??[]}function r(t){return t?.map(e=>e.Total)??[]}function m(t){return t?.map(e=>e.EventType)??[]}function y(t){let e=[];return t?.map(a=>e.push({x:a.EventLabel,y:a.Total})),e}var k=1e4,d=document.getElementById("project-id")?.textContent,n=d?JSON.parse(d):null,p=document.getElementById("weekly-events")?.textContent,v=p?JSON.parse(p):[],u=document.getElementById("event-type-chart")?.textContent,g=u?JSON.parse(u):[],h=document.getElementById("event-label-chart")?.textContent,T=h?JSON.parse(h):[],S=x(v),C=r(v),B=m(g),I=r(g),L=y(T),f=document.getElementById("weekly-event-total"),A={chart:{height:"300px",maxWidth:"100%",type:"area",dropShadow:{enabled:!0},toolbar:{show:!1},animations:{enabled:!1},zoom:{enabled:!1}},tooltip:{enabled:!0,x:{show:!0}},fill:{type:"gradient",gradient:{opacityFrom:.55,opacityTo:0,shade:"#1C64F2",gradientToColors:["#1C64F2"]}},dataLabels:{enabled:!1,style:{fontFamily:"Space Grotesk"}},stroke:{width:6},grid:{show:!1,strokeDashArray:4,padding:{left:2,right:2,top:0}},series:[{name:"Events",data:C,color:"#1A56DB"}],xaxis:{categories:S,labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{show:!1}},o={series:I,chart:{height:"380px",width:"100%",type:"pie",animations:{enabled:!1}},stroke:{colors:["white"],lineCap:""},plotOptions:{pie:{labels:{show:!0},size:"100%",dataLabels:{offset:-25}}},labels:B,dataLabels:{enabled:!0,style:{fontFamily:"Space Grotesk"}},legend:{position:"bottom",fontFamily:"Space Grotesk, sans-serif"},xaxis:{axisTicks:{show:!0},axisBorder:{show:!0}}},c={series:[{name:"X Event Fired",data:L}],chart:{type:"bar",height:"350px",fontFamily:"Space Grotesk, sans-serif",toolbar:{show:!1},animations:{enabled:!1}},plotOptions:{bar:{distributed:!0,horizontal:!1,columnWidth:"70%",borderRadiusApplication:"end",borderRadius:8}},tooltip:{shared:!0,intersect:!1,style:{fontFamily:"Space Grotesk, sans-serif"}},states:{hover:{filter:{type:"darken",value:1}}},stroke:{show:!0,width:0,colors:["transparent"]},grid:{show:!1,strokeDashArray:4,padding:{left:2,right:2,top:-14}},dataLabels:{enabled:!0},legend:{show:!1},xaxis:{floating:!0,labels:{show:!1,style:{fontFamily:"Space Grotesk, sans-serif",cssClass:"text-xs font-light fill-gray-500 dark:fill-gray-400"}},axisBorder:{show:!0},axisTicks:{show:!0}},yaxis:{show:!1},fill:{opacity:1}},b=new ApexCharts(document.getElementById("area-chart"),A),w=new ApexCharts(document.getElementById("pie-chart"),o),E=new ApexCharts(document.getElementById("column-chart"),c);b.render();w.render();E.render();setInterval(function(){Promise.allSettled([F(b),O(w),D(E)])},k);function F(t){$.ajax({url:`/api/json/event/chart/${n}`,type:"GET",success:function(e){let a=r(e.Time);f&&(f.innerText=e.Total??0),t.updateSeries([{name:"Events",data:a,color:"#1A56DB"}])},error:function(){console.log("Error fetching new chart data")}})}function O(t){$.ajax({url:`/api/json/event-type/chart/${n}`,type:"GET",success:function(e){let a=r(e),s=m(e);o.labels=s,o.series=a,t.updateOptions(o)},error:function(){console.log("Error fetching new chart data")}})}function D(t){$.ajax({url:`/api/json/event-label/chart/${n}`,type:"GET",success:function(e){let a=y(e);c.series=[{name:"X Event Fired",data:a}],t.updateOptions(c)},error:function(){console.log("Error fetching new chart data")}})}function G(){let t=document.getElementById("events-live-table"),e=document.getElementById("events-live-selector"),a=localStorage.getItem("events-live-selector");a&&(s(a),e.value=a),e?.addEventListener("change",l=>{let i=l.target?.value;i&&(s(i),localStorage.setItem("events-live-selector",i))});function s(l){switch(l){case"last_hour":t?.setAttribute("hx-get",`/api/event/live/${n}?strategy=last_hour`);break;case"last_100":t?.setAttribute("hx-get",`/api/event/live/${n}?strategy=last_100`);break;default:break}htmx.process(t)}}G();})();
